
## Постановка задачи

Есть несколько рабочих сервисов Каждый сервис может находиться в одном из состояний: "работает", "не работает", "работает нестабильно".

Требуется написать API, который:
1. Получает и сохраняет данные:
  - имя
  - состояние
  - описание
2. Выводит список сервисов с актуальным состоянием.
3. По имени сервиса выдает историю изменения состояния и все данные по каждому состоянию.
4. По указанному интервалу выдается информация о том, сколько не работал сервис (SLA в процентах до 3-й запятой).
Вывод всех данных должен быть в формате JSON.

## Реализация

Сервис API реализован при помощи фреймворков Django и Django REST framework.
Сервис имеет систему аутентификафии. Работа с сервисов доступна только для аутентифицированных пользователей с уровнем прав "суперпользователь"
или "персонал". Создание пользователя возможно через админ-панель Django или посредством API, а назначение прав - только через админ-панель.
1. Сервис получает данные об одном или нескольких рабочих сервисах (имя, состояние, описание) и сохраняет в БД (SQLite по умолчанию). При сохранени в БД каждой записи
присваивается неизменяемая временная метка. Если при этом о каком-либо рабочем сервисе не было записи в БД, она создается автоматичеки (т.е. список рабочих сервисов
не предопределен). 
2. Реализован вывод последнего сохраненного состояния для всех отметившихся в БД рабочих сервисов.
3. Для указанного в запросе рабочего сервиса доступен вывод всех записей о его состоянии за выбранный период в полном или сжатом варианте.
4. Для указанного в запросе рабочего сервиса доступен вывод показателя стабильности его работы (учитываются только состояния "работает").

## Описание эндпойнтов

1. [/admin]() - админ-панель Django (web-интерфейс);
2. [/api/users]() - создание пользователя;
  - тип запроса: POST,
  - авторизация не требуется,
  - тело запроса (JSON):
  ```json
    {
     "email": "user@yandex.ru",
     "username": "user.pupkin",
     "first_name": "Юзер",
     "last_name": "Апи",
     "password": "Qwerty123"
    }
  ```
  - параметры запроса: отсутствуют
  - тело ответа (JSON):
  ```json
    {
     "email": "user@yandex.ru",
     "username": "user.pupkin",
     "first_name": "Юзер",
     "last_name": "Апи",
     "password": "Qwerty123",
     "id": "1"
    }
  ```
3. [/api/auth/token/login/]() - получение токена;
  - тип запроса: POST,
  - авторизация не требуется,
  - тело запроса (JSON):
  ```json
    {
     "email": "user@yandex.ru",
     "username": "user.pupkin"
    }
  ```
  - параметры запроса: отсутствуют
  - тело ответа (JSON):
  ```json
    {
     "auth_token": "токен"
    }
  ```
4. [/api/auth/token/logout/]() - удаление токена;
  - тип запроса: POST,
  - авторизация: требуется, через параметр в заголовке запроса:
    ***Authorization: Token значение_токена***
  - тело запроса (JSON): отсутствует,
  - параметры запроса: отсутствуют,
  - тело ответа (JSON): отсутствует;

5. [/api/info/all]() - получение текущего статуса всех рабочих сервисов;
  - тип запроса: GET,
  - авторизация: требуется, через параметр в заголовке запроса:
    ***Authorization: Token значение_токена***
  - тело запроса (JSON): отсутствует,
  - параметры запроса: отсутствуют,
  - тело ответа (JSON): отсутствует;

6. [/api/info/{имя_сервиса}]() - получение истории состояний рабочего сервиса;
  - тип запроса: GET,
  - авторизация: требуется, через параметр в заголовке запроса:
    ***Authorization: Token значение_токена***
  - тело запроса (JSON): отсутствует,
  - параметры запроса:
    + ***start-time***, ***end-time*** - ограничение периода выборки,
    указываются вместе или по отдельности в формате *2023-01-16T15:52:35* или *2023-01-16*;
    + ***shifts_only*** - если равен *false*, выводятся все временные метки, а если равен *true* - 
    только метки, соответствующие изменению статуса сервиса (т.е. статус сервиса в этой метке отличается
    от статуса в предыдущей метке);
    + пример запроса: [/api/info/test?start-time=2023-01-11T15:52:35&end-time=2023-01-16&shifts_only=true]()
  - тело ответа (JSON):
    ```json
    [
     {
      "service": "test",
      "time_stamp": "2023-01-11T18:13:14.369634Z",
      "status": "working",
      "description": ""
     },
    {
      "service": "test",
      "time_stamp": "2023-01-11T18:19:29.720103Z",
      "status": "unstable",
      "description": ""
    },
    ]
  ```
7. [/api/info/{имя_сервиса}/sla]() - доля времени, в течение которого сервис находился в статусе "работает";
  - тип запроса: GET,
  - авторизация: требуется, через параметр в заголовке запроса:
    ***Authorization: Token значение_токена***
  - тело запроса (JSON): отсутствует,
  - параметры запроса:
    + ***start-time***, ***end-time*** - ограничение периода выборки,
    указываются вместе или по отдельности в формате *2023-01-16T15:52:35* или *2023-01-16*;
     + пример запроса: [/api/info/test/sla?start-time=2023-01-11T15:52:35&end-time=2023-01-16]()
  - тело ответа (JSON):
    ```json
    {
      "sla": "99.522 %"
    }
    ```
7. [/api/set]() - сохранение статуса одного или нескольких сервисов;
  - тип запроса: POST,
  - авторизация: требуется, через параметр в заголовке запроса:
    ***Authorization: Token значение_токена***
  - тело запроса (JSON):
    ```json
    [
      {
        "service": "tot",
        "status": "down",
        "description": "tutta"
      },
      {
        "service": "test",
        "status": "working",
        "description": "from space"
      }
    ]
    ```
  - параметры запроса: отсутствуют;
  - тело ответа (JSON):
    ```json
    [
      {
        "service": "tot",
        "status": "down",
        "description": "tutta"
      },
      {
        "service": "test",
        "status": "working",
        "description": "from space"
      }
    ]
    ```

## Развертывание проекта

1. Перед развертыванием необходимо установить Python 3.7 или новее, Pip.
2. Выполнить клонирование проекта на локальный компьютер.
- В терминале (командной строке) перейти  в папку проекта (task-backend) и установить виртуальное окружение (*python -m venv venv*).
- Активировать виртуальное окружение. (В Windows выполнить *source venv/scripts/activate* .
 В Linux выполнить *source venv/bin/activate* .)
- Запустить установку библиотек, перечисленных в requirements.txt (*pip install -r requirements.txt*).
- Перейти в папку *informer* и выполнить создание суперпользователя (*python manage.py createsuperuser*).
- В папке *informer* создать файл .env и внести в него запись вида *SECRET_KEY = "набор-из-50-цифр-букв-символов"*.
- Запустить проект: *python manage.py runserver* .